#!/usr/bin/env bash
set -euo pipefail

pgrep talon && exit 0

export TERM=xterm-256color
export NIXPKGS_ALLOW_UNFREE=1

notify-send "Starting talon..."

channel='https://github.com/NixOS/nixpkgs/archive/c8f89b1c7ce876a7d0a7f172f8fc78c63176ab2b.tar.gz'  # NixOS release-25.05 as of 2025-08-31
pgrep snixembed || snixembed &

mkdir -p /tmp/talon && cd /tmp/talon
nix build -Lvf $channel talon

./result/bin/talon
